# Polyply and Martinize2 format Martini3-IDP force field files used to generate IDP/IDR protein models.

**Tutorial3:**

Martini3-IDP force field have been implemented in the latest version [Martinize2](https://github.com/marrink-lab/vermouth-martinize).

The IDR region could be defined by `-idr-tune -id-regions` flags. The remaing folded domains still adopt the secondary structure from DSSP or `-ss`.
```
martinize2 -f AF-CK1.pdb -x cg.pdb -o topol.top -ff martini3IDP -p backbone -elastic -ef 700.0 -el 0 -eu 0.85 -eunit 1:292 -idr-tune -id-regions 293:415 -ss CCCEETTTEEEEEEEEECSSSEEEEEEETTTTEEEEEEEEETTCSSCCHHHHHHHHHHHTTSTTCCCEEEEEEETTEEEEEEECCCCBHHHHHHHTTTCCCHHHHHHHHHHHHHHHHHHHHTTEECCCCCGGGEEECCGGGTTCEEECCCTTCEECBCTTTCCBCCCCBSTTCCSCTTTCCHHHHTTBCCCHHHHHHHHHHHHHHHHHSSCTTSSCCCSSGGGHHHHHHHHHHHSCHHHHTTTSCHHHHHHHHHHHHSCSSCCCCHHHHHHHHHHHHHHTTCCCSCCCGGGCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
```

**Tutorial1:**

A Martinize2 format Martini3-IDP force field file is provided, which deals with the construction discrepancy between standard Martini3 protein and Martini3-IDP well. For example, `-scFix` is applied in Martini3 protein model to define sidechain orientation relying on atomistic reference structure, whereas general bonded parameters are used to define sidechain dynamics in Martini3-IDP independent on reference atomistic structure.

In this tutorial, we use full length CK1 protein atomistic structure as Martinize2 input. As IDR structure is hardly resolved in crystal structure, [Alphafold prediction](https://alphafold.ebi.ac.uk/) or [Swiss-model](https://swissmodel.expasy.org/) could be used to generate full length atomistic protein structure with high-confidence folded domain. Elastic network bias was generated only in the folded domain (by `-eunit` flag). To define IDR easily, a new secondary structure `D` is provided in the `-ss` flag. It’s noted that `D` isn’t a pre-set secondary structure, so `D` secondary structure should be manually added to `vermouth/dssp/dssp.py` ss_cg list.
```
martinize2 -f AF-CK1.pdb -x CK1d_cg.pdb -o CK1d_only.top -ff martini3001-IDP -p backbone -cys auto -scfix -elastic -ef 700.0 -el 0 -eu 0.85 -eunit 1:292 -ss CCCEE TTTEEEEEEEEECSSSEEEEEEETTTTEEEEEEEEETTCSSCCHHHHHHHHHHHTTSTTCCCEEEEEEETTEEEEEEECCCCBHHHHHHHTTTCCCHHHHHHHHHHHHHHHHHHHHTTEECCCCCGGGEEECCGGGTTCEEECCCTTCEECBCTTTCCBCCCCBSTTCCSCTTTCCHHHHTTBCCCHHHHHHHHHHHHHHHHHSSCTTSSCCCSSGGGHHHHHHHHHHHSCHHHHTTTSCHHHHHHHHHHHHSCSSCCCCHHHHHHHHHHHHHHTTCCCSCCCGGGCDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD
```


**Tutorial2:**

1. Polyply is used to generate the topology and coordinates files of the IDR domain. 
`polyply gen_params` is used to generate the topology with protein sequence fasta input by `-seqf`(or protein sequence string by `-seq`). `-f` flag provides the force field. `polyply gen_coords` is used to generate a random IDR coordinates file by random walking with only IDR topology provided (`-p` flag). `-box` here defines the box of coordinates, `-o` defines the coordinates file name.
```
polyply gen_params -name IDR -f Martini3-IDP_Poplyply.ff -seqf IDR.fasta -o IDR.itp
```
2. Topology of protein folded domain is generated by Martinize2 
3. A python script [topology_merging_general.py](https://github.com/Martini-Force-Field-Initiative/Martini3-IDP-parameters/blob/main/Scripts/topology_merging_general.py) is used to merge all domain’s itp and define the parameters of the crosslinking region. You have to change the itp file name and moleculetype to `mol0 mol1 …` according to the sequence in protein. And because sometimes dihedral parameters in Martini topology are defined in two individual `[ dihedrals ]` derivatives, for consistency, we need to merge `[ dihedrals ]` derivatives in the itp files with two `[ dihedrals ]` derivatives by definition in topology_merging_general.py:
```
mols['mol0']['dihedrals'] = mols['mol0']['dihedrals'] + mols['mol0']['dihedrals1']
```
Then based on the domain number in protein, we need to adjust some definitions by order in topology_merging_general.py (For example, three domains `mol0-mol1-mol2` are merged):
```
mol0_BB, mol0_SC, mol1_BB, mol1_SC = entry_edit(mols, 'mol0', 'mol1')
mol1_BB, mol1_SC, mol2_BB, mol2_SC = entry_edit(mols, 'mol1', 'mol2')
interaction_adding(ff, molname, mol0_BB, mol0_SC, mol1_BB, mol1_SC)
interaction_adding(ff, molname, mol1_BB, mol1_SC, mol2_BB, mol2_SC)
```
Output itp file mol.itp was generated by default. 
```
python3 topology_merging_general.py
```
4. It’s noted that the terminal bead type in each domain fragment (i.e. the crosslinking region in multi-domain protein) has to be checked and adjusted the default Martini3 backbone bead in output mol.itp.   
5. The coordinates file of complete multi-domain protein is easy to obtain after a short simulation due to the bonded linking between fragments in mol.itp.
